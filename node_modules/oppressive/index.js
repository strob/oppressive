var fs = require('fs');

module.exports = function(BASE_DIR, io) {
    var STORE = {};
    var _load = function(jsonfile, cb) {
        if(! (jsonfile in STORE)) {
            STORE[jsonfile] = JSON.parse(fs.readFileSync(BASE_DIR + '/' + jsonfile + '.json'));
        }
        cb(STORE[jsonfile]);
    }

    io.sockets.on('connection', function(socket) {
        socket.on("load", _load);
    });

    // Expose the client Oppressive codebase
    var code = {
        "oppressive.js": fs.readFileSync(__dirname + "/oppressive.online.js")
    };

    return {code: code};
};
